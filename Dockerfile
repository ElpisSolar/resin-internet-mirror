# AUTOGENERATED BY MAKE - DO NOT MODIFY MANUALLY
FROM resin/amd64-alpine

RUN apk add --update -t build-deps build-base git zlib-dev openssl-dev \
 && git clone https://github.com/xroche/httrack.git --recurse \
      /usr/src/httrack \
 && cd /usr/src/httrack \
 && ./configure \
 && make -j8 \
 && make install \
 && apk add --update hostapd dnsmasq s6 nginx openssh openssl \
 && sed -i 's/#PermitRootLogin.*/PermitRootLogin\ yes/' \
      /etc/ssh/sshd_config \
 && apk del build-deps \
 && rm -rf /usr/src/httrack

VOLUME [ "/data" ]
EXPOSE 80

ENV SITES https://5pi.de

RUN mkdir /www \
 && cd /www \
 && httrack $SITES \
 && find . -type f -maxdepth 1 -delete \
 && rm -rf hts-cache

COPY files /
ENTRYPOINT [ "/run.sh" ]
